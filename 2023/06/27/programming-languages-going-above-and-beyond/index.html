<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Programming Languages Going Above and Beyond"><meta name=twitter:title content="Programming Languages Going Above and Beyond"><meta property="og:description" content="Dafny is a programming language which often genuinely amazes me."><meta name=twitter:description content="Dafny is a programming language which often genuinely amazes me."><meta property="og:image" content="https://whileydave.com/images/2023/DafnyAbove_Preview.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://whileydave.com/images/2023/DafnyAbove_Preview.png"><meta property="og:url" content="https://whileydave.com/2023/06/27/programming-languages-going-above-and-beyond/"><title>David J. Pearce
(Programming Languages Going Above and Beyond)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css><link rel=stylesheet href=https://whileydave.com/css/syntax.css></head><body><script>"use strict";function clearMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display="none",t.style.filter="")}function toggleMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display==="block"?(e.style.display="none",t.style.filter=""):(e.style.display="block",t.style.filter="brightness(0.8)"))}function toggleList(e){e.style.display="none";for(var t,o=e.parentNode,s=o.childNodes,n=0;n<s.length;++n)t=s[n],t.classList&&t.classList.contains("hidden")&&(t.style.display==="block"?t.style.display="none":t.style.display="block")}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a>
<a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a>
<a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a>
<a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Programming Languages Going Above and Beyond</h1><div class=post-date>Tuesday, June
27th,
2023</div><hr><p>Having been a programmer for a long time now, I have experienced my
fair share of programming languages. What strikes me the most is that
programming languages have not improved much over the years. Java,
for example, has certainly improved from when I started using it in
the mid-nineties &mdash; but only in pretty minor ways. We still get
buffer overflows and integer overflows. The compiler still cannot
tell when our loops will terminate (yes, this is possible). Aliasing
is still a complete unbridled mess. Even Rust, my favourite language
du jour, only offers a minor improvement on the status quo. These are
not stop-the-world everything has changed kind of improvements.</p><p>Still, big improvements are possible. I now use, on a daily basis, a
language (<a href=https://github.com/dafny-lang/dafny/>Dafny</a>) which often
genuinely amazes me. I&rsquo;ll admit, its not super easy to use and
perhaps not ready yet for mainstream &mdash; but, it gives a glimpse of
what is possible. Dafny&rsquo;s ability to statically check critical
properties of your program goes well beyond what mainstream languages
can do (that includes you, Rust). Here&rsquo;s a simple example:</p><pre tabindex=0><code class=language-dafny data-lang=dafny>function Gcd(a:nat, b:nat) : (g:nat,x:int,y:int))
// Bezout&#39;s identity
ensures (a*x)+(b*y) == g
{
    if a == 0 then (b,0,1)
    else
        var (g,x,y) := Gcd(b%a,a);
        (g,y-((b/a)*x),x)
}
</code></pre><p>This is a recursive implementation of <a href=https://en.wikipedia.org/wiki/Extended_Euclidean_algorithm>Euclid&rsquo;s extended GCD
algorithm</a>
(i.e. an integral part of modern cryptography, including
<a href=https://en.wikipedia.org/wiki/RSA_(cryptosystem)>RSA</a> and
<a href=https://en.wikipedia.org/wiki/Elliptic-curve_cryptography>ECC</a>).
Using the <code>ensures</code> clause I&rsquo;ve specified a
<a href=https://en.wikipedia.org/wiki/Postcondition>postcondition</a> &mdash; that
is, a property that should always hold of the return value. This
particular postcondition corresponds to <a href=https://en.wikipedia.org/wiki/B%C3%A9zout%27s_identity>Bézout&rsquo;s
identity</a>.
That is, <em>a theorem about numbers proved by Étienne Bézout in the 18th
century</em>. The amazing thing is that, in order to check my program is
correct, Dafny has reproved this theorem for me.</p><h2 id=bits-and-bytes>Bits and Bytes</h2><p>The above example was taken from our <a href=https://github.com/Consensys/evm-dafny/blob/63a9da2335634572bfb1dcf616c7eda081bf7d8f/src/dafny/util/int.dfy#L185>DafnyEVM
codebase</a>.
Here&rsquo;s <a href=https://github.com/Consensys/evm-dafny/blob/63a9da2335634572bfb1dcf616c7eda081bf7d8f/src/dafny/util/int.dfy#L254>another
example</a>
which is, perhaps, more concrete:</p><pre tabindex=0><code class=language-dafny data-lang=dafny>function ToBytes(v:nat) : (r:seq&lt;u8&gt;)
ensures |r| &gt; 0 {
  // Extract the byte
  var byte : u8 := (v % 256) as u8;
  // Determine what&#39;s left
  var w : nat := v/256;
  if w == 0 then [byte]
  else
    ToBytes(w) + [byte]
}
</code></pre><p>The above is a straightforward (recursive) function for converting an
arbitrary sized unsigned integer (<code>nat</code>) into a sequence of one or
more bytes (following a big endian representation). Here, <code>ToBytes()</code>
has an <code>ensures</code> clause clarifying it always returns a non-empty
sequence. <em>Dafny checks at compile time that this is always true</em>.</p><p>Now, here is a function taking us in the opposite direction:</p><pre tabindex=0><code class=language-dafny data-lang=dafny>function FromBytes(bytes:seq&lt;u8&gt;) : (r:nat) {
  if |bytes| == 0 then 0
  else
    var last := |bytes| - 1;
    var byte := bytes[last] as nat;
    var msw := FromBytes(bytes[..last]);
    (msw * 256) + byte
}
</code></pre><p>There isn&rsquo;t anything too special going on here (yet). But, now the
magic begins! What we want to know is that these two functions are
&ldquo;opposites&rdquo; of each other. We can do this like so:</p><pre tabindex=0><code>lemma LemmaFromToBytes(v: nat)
ensures FromBytes(ToBytes(v)) == v {
 // Dafny does all the work!
}
</code></pre><p>This might not seem like much, but it represents something you cannot
easily do in other languages. This <code>lemma</code> asks Dafny to check that,
for any possible <code>nat</code> value <code>v</code>, it always holds that
<code>FromBytes(ToBytes(v)) == v</code>. <em>Again, Dafny checks this at compile
time &mdash; no testing required!</em></p><p>Finally, an interesting puzzle remains. For an arbitrary sequence
<code>bs</code> of bytes, does <code>ToBytes(FromBytes(bs)) == bs</code> always hold?
Again, Dafny can answer this for us almost immediately. If
you&rsquo;re interested to know the answer, take a look at the <a href=https://github.com/Consensys/evm-dafny/blob/63a9da2335634572bfb1dcf616c7eda081bf7d8f/src/dafny/util/int.dfy#L310>lemma we
came up
with</a>.</p><hr></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MRLB1FVZX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MRLB1FVZX",{anonymize_ip:!1})}</script></body></html>