<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Contractive and Uninhabited Types in Whiley"><meta name=twitter:title content="Contractive and Uninhabited Types in Whiley"><meta property="og:url" content="https://whileydave.com/2016/04/21/contractive-and-uninhabited-types-in-whiley/"><title>David J. Pearce
(Contractive and Uninhabited Types in Whiley)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css><link rel=stylesheet href=https://whileydave.com/css/syntax.css></head><body><script>"use strict";function clearMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display="none",t.style.filter="")}function toggleMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display==="block"?(e.style.display="none",t.style.filter=""):(e.style.display="block",t.style.filter="brightness(0.8)"))}function toggleList(e){e.style.display="none";for(var t,o=e.parentNode,s=o.childNodes,n=0;n<s.length;++n)t=s[n],t.classList&&t.classList.contains("hidden")&&(t.style.display==="block"?t.style.display="none":t.style.display="block")}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a>
<a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a>
<a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a>
<a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Contractive and Uninhabited Types in Whiley</h1><div class=post-date>Thursday, April
21st,
2016</div><hr><p>An interesting feature of Whiley is that it supports true <a href=https://github.com/Whiley/WhileyCompiler/issues/631>recursive types</a>.  These are surprisingly tricky to get right, and recently we came across some interesting examples that the Whiley compiler should (but doesn&rsquo;t) check for.</p><h2 id=recursive-types>Recursive Types</h2><p>The following illustrates the syntax for recursive types in Whiley:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>type</span> <span class=n>Link</span> <span class=k>is</span> <span class=p>{</span><span class=n>any</span> <span class=n>data</span><span class=p>,</span> <span class=n>LinkedList</span> <span class=n>next</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=n>LinkedList</span> <span class=k>is</span> <span class=kc>null</span> <span class=o>|</span> <span class=n>Link</span>
</span></span></code></pre></div><p>The type <code>{any data, LinkedList next}</code> indicates a record with two fields <code>data</code> and <code>next</code>, whilst <code>null | Link</code> indicates a <em>union</em> of <code>null</code> and <code>Link</code>. So, a <code>LinkedList</code> is either <code>null</code> or a record of type <code>{any data, LinkedList next}</code>. A simple function operating over <code>LinkedList</code>s is given as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>function</span> <span class=n>length</span><span class=p>(</span><span class=n>LinkedList</span> <span class=n>list</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kt>int</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=n>l</span> <span class=k>is</span> <span class=kc>null</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span> <span class=o>+</span> <span class=n>length</span><span class=p>(</span><span class=n>list</span><span class=p>.</span><span class=n>next</span><span class=p>)</span>
</span></span></code></pre></div><p>This returns the number of links in the list. The runtime type test operator, <code>is</code>, distinguishes the two cases. Since Whiley employs <a href=https://en.wikipedia.org/wiki/Flow-sensitive_typing>flow typing</a>, variable <code>list</code> is automatically retyped to <code>{any data, LinkedList next}</code> on the false branch.</p><h2 id=subtyping>Subtyping</h2><p>With this in mind, let us now think about subtyping between recursive types in Whiley:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=c1>// A linked list with at least one link
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=n>NonEmptyList</span> <span class=k>is</span> <span class=p>{</span><span class=n>any</span> <span class=n>data</span><span class=p>,</span> <span class=n>LinkedList</span> <span class=n>next</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// A linked list containing integer data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=n>IntList</span> <span class=k>is</span> <span class=p>{</span><span class=kt>int</span> <span class=n>data</span><span class=p>,</span> <span class=n>IntList</span> <span class=n>next</span><span class=p>}</span>
</span></span></code></pre></div><p>Both of the above types are implicit subtypes of <code>LinkedList}</code> Thus, for example, any variable of type <code>NonEmptyList</code> or <code>IntList</code> can be passed into the function <code>length()</code>.</p><h2 id=contractive-or-uninhabitable>Contractive or Uninhabitable?</h2><p>The Whiley Compiler should accept the above recursive types without trouble. However, it is possible to write recursive types which should be rejected by the compiler. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>type</span> <span class=n>Invisible</span> <span class=k>is</span> <span class=n>Invisible</span> <span class=o>|</span> <span class=n>Invisible</span>
</span></span></code></pre></div><p>This type does not correspond to any possible runtime value in Whiley (i.e. is uninhabited) and, hence, the compiler should report a syntax error here. Likewise, consider another example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>type</span> <span class=n>InfList</span> <span class=k>is</span> <span class=p>{</span> <span class=n>InfList</span> <span class=n>next</span><span class=p>,</span> <span class=kt>int</span> <span class=n>data</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=n>get</span><span class=p>(</span><span class=n>InfList</span> <span class=n>l</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=p>(</span><span class=n>InfList</span> <span class=n>r</span><span class=p>,</span> <span class=kt>int</span> <span class=n>d</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>l</span><span class=p>.</span><span class=n>next</span><span class=p>,</span> <span class=n>l</span><span class=p>.</span><span class=n>data</span>
</span></span></code></pre></div><p>In languages with lazy evaluation (like Haskell) such a type would be pretty reasonable. However, in Whiley, all values are trees of <em>finite</em> height &mdash; so it is physically impossible construct an value of type <code>InfList</code>. So, the compiler should report an error in such case.</p><h2 id=conclusion>Conclusion</h2><p>Recursive types are pretty tricky to implement and get right.  The implementation in the Whiley compiler is now almost four years old, and it generally works pretty well.  But, the compiler isn&rsquo;t currently checking for types which are uninhabitable (see issue <a href=https://github.com/Whiley/WhileyCompiler/issues/631>#631</a> raised for this).  Still work to do then &mldr;</p><hr></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-5582165-7","auto"),ga("send","pageview"))</script></body></html>