<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Contractive and Uninhabited Types in Whiley"><meta name=twitter:title content="Contractive and Uninhabited Types in Whiley"><meta property="og:url" content="https://whileydave.com/2016/04/21/contractive-and-uninhabited-types-in-whiley/"><title>David J. Pearce
(Contractive and Uninhabited Types in Whiley)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css></head><body><script>"use strict";function clearMenu(){var q=window.matchMedia("(max-width: 992px)");if(q.matches){var c=document.getElementById("menu-content");var m=document.getElementById("menu");c.style.display='none';m.style.filter='';}}
function toggleMenu(){var q=window.matchMedia("(max-width: 992px)");if(q.matches){var c=document.getElementById("menu-content");var m=document.getElementById("menu");if(c.style.display==='block'){c.style.display='none';m.style.filter='';}else{c.style.display='block';m.style.filter="brightness(0.8)";}}}
function toggleList(element){element.style.display="none";var parent=element.parentNode;var items=parent.childNodes;for(var i=0;i<items.length;++i){var item=items[i];if(item.classList&&item.classList.contains("hidden")){if(item.style.display==='block'){item.style.display="none";}else{item.style.display="block";}}}}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a><a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a><a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a><a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Contractive and Uninhabited Types in Whiley</h1><div class=post-date>Thursday, April
21st,
2016</div><hr><p>An interesting feature of Whiley is that it supports true <a href=https://github.com/Whiley/WhileyCompiler/issues/631>recursive types</a>.  These are surprisingly tricky to get right, and recently we came across some interesting examples that the Whiley compiler should (but doesn&rsquo;t) check for.</p><h2 id=recursive-types>Recursive Types</h2><p>The following illustrates the syntax for recursive types in Whiley:</p><pre><code class=language-whiley data-lang=whiley>type Link is {any data, LinkedList next}
type LinkedList is null | Link
</code></pre><p>The type <code>{any data, LinkedList next}</code> indicates a record with two fields <code>data</code> and <code>next</code>, whilst <code>null | Link</code> indicates a <em>union</em> of <code>null</code> and <code>Link</code>. So, a <code>LinkedList</code> is either <code>null</code> or a record of type <code>{any data, LinkedList next}</code>. A simple function operating over <code>LinkedList</code>s is given as follows:</p><pre><code class=language-whiley data-lang=whiley>function length(LinkedList list) -&gt; int:
    //
    if l is null:
        return 0
    else:
        return 1 + length(list.next)
</code></pre><p>This returns the number of links in the list. The runtime type test operator, <code>is</code>, distinguishes the two cases. Since Whiley employs <a href=https://en.wikipedia.org/wiki/Flow-sensitive_typing>flow typing</a>, variable <code>list</code> is automatically retyped to <code>{any data, LinkedList next}</code> on the false branch.</p><h2 id=subtyping>Subtyping</h2><p>With this in mind, let us now think about subtyping between recursive types in Whiley:</p><pre><code class=language-whiley data-lang=whiley>// A linked list with at least one link
type NonEmptyList is {any data, LinkedList next}

// A linked list containing integer data
type IntList is {int data, IntList next}
</code></pre><p>Both of the above types are implicit subtypes of <code>LinkedList}</code> Thus, for example, any variable of type <code>NonEmptyList</code> or <code>IntList</code> can be passed into the function <code>length()</code>.</p><h2 id=contractive-or-uninhabitable>Contractive or Uninhabitable?</h2><p>The Whiley Compiler should accept the above recursive types without trouble. However, it is possible to write recursive types which should be rejected by the compiler. For example:</p><pre><code class=language-whiley data-lang=whiley>type Invisible is Invisible | Invisible
</code></pre><p>This type does not correspond to any possible runtime value in Whiley (i.e. is uninhabited) and, hence, the compiler should report a syntax error here. Likewise, consider another example:</p><pre><code class=language-whiley data-lang=whiley>type InfList is { InfList next, int data }

function get(InfList l) -&gt; (InfList r, int d):
   return l.next, l.data
</code></pre><p>In languages with lazy evaluation (like Haskell) such a type would be pretty reasonable. However, in Whiley, all values are trees of <em>finite</em> height &mdash; so it is physically impossible construct an value of type <code>InfList</code>. So, the compiler should report an error in such case.</p><h2 id=conclusion>Conclusion</h2><p>Recursive types are pretty tricky to implement and get right.  The implementation in the Whiley compiler is now almost four years old, and it generally works pretty well.  But, the compiler isn&rsquo;t currently checking for types which are uninhabitable (see issue <a href=https://github.com/Whiley/WhileyCompiler/issues/631>#631</a> raised for this).  Still work to do then &mldr;</p><hr></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-5582165-7','auto');ga('send','pageview');}</script></body></html>