<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Understanding Ghost Variables in Software Verification"><meta name=twitter:title content="Understanding Ghost Variables in Software Verification"><meta property="og:url" content="https://whileydave.com/2014/06/20/understanding-ghost-variables-in-software-verification/"><title>David J. Pearce
(Understanding Ghost Variables in Software Verification)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css><link rel=stylesheet href=https://whileydave.com/css/syntax.css></head><body><script>"use strict";function clearMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display="none",t.style.filter="")}function toggleMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display==="block"?(e.style.display="none",t.style.filter=""):(e.style.display="block",t.style.filter="brightness(0.8)"))}function toggleList(e){e.style.display="none";for(var t,o=e.parentNode,s=o.childNodes,n=0;n<s.length;++n)t=s[n],t.classList&&t.classList.contains("hidden")&&(t.style.display==="block"?t.style.display="none":t.style.display="block")}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a>
<a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a>
<a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a>
<a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Understanding Ghost Variables in Software Verification</h1><div class=post-date>Friday, June
20th,
2014</div><hr><p>Verification tools often support the use of <em>ghost variables</em> to help in the verification process. A ghost variable is not needed for the program to execute, and will not be compiled into <a href=http://en.wikipedia.org/wiki/Object_code>object code</a>. Typically, they are declared with a <code>ghost</code> modifier or similar, but are otherwise identical to normal program variables (i.e. they have a type, support the usual operators, etc). The purpose of ghost variables provide a way for the programmer to guide the verifier in checking a program is correct. The <a href=http://openjml.org/>Java Modelling Language</a>, <a href=http://research.microsoft.com/en-us/projects/specsharp/>Spec#</a>, <a href=http://research.microsoft.com/en-us/projects/dafny/>Dafny</a>, and <a href=http://frama-c.com/>Frama-C</a> all support ghost variables in some manner (see e.g. <a href="https://www.youtube.com/watch?v=P2durYFsJSA">this tutorial</a> on using them in Dafny).</p><p>In the Whiley programming language there is currently no support for ghost variables.  However, it turns out that you can still achieve the same effect using just local variables.  In the future, we may extend Whiley to support an explicit <code>ghost</code> modifier.</p><h2 id=example>Example</h2><p>To illustrate what ghost variables are, consider verifying the following simple function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>function</span> <span class=n>add</span><span class=p>([</span><span class=kt>int</span><span class=p>]</span> <span class=n>v1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>c</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>([</span><span class=kt>int</span><span class=p>]</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Return must have same length as parameters
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ensures</span> <span class=o>|</span><span class=n>v2</span><span class=o>|</span> <span class=o>==</span> <span class=o>|</span><span class=n>v1</span><span class=o>|:</span>
</span></span><span class=line><span class=cl>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=o>|</span><span class=n>v1</span><span class=o>|</span> <span class=k>where</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>v1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>      <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>return</span> <span class=n>v1</span>
</span></span></code></pre></div><p>This function accepts a list of integers and adds a constant to each. The Whiley compiler will not verify this function and complains that the <em>postconditon is not satisfied</em>. This is because the loop invariant says nothing about the size of variable <code>v1</code>, and so the compiler knows nothing after the loop about it (e.g. that it was unchanged by the loop).</p><p>To verify the above function the loop invariant needs to state <em>the size of v1 is not modified by the loop</em>.  Unfortunately, there is no explicit syntax for expressing loop variants in Whiley.  Instead, we can simulate a <em>ghost variable</em> to achieve the same effect:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kd>function</span> <span class=n>add</span><span class=p>([</span><span class=kt>int</span><span class=p>]</span> <span class=n>v1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>c</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>([</span><span class=kt>int</span><span class=p>]</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Return must have same length as parameters
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ensures</span> <span class=o>|</span><span class=n>v2</span><span class=o>|</span> <span class=o>==</span> <span class=o>|</span><span class=n>v1</span><span class=o>|:</span>
</span></span><span class=line><span class=cl>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>tmp</span> <span class=o>=</span> <span class=o>|</span><span class=n>v1</span><span class=o>|</span> <span class=c1>// ghost variable
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=o>|</span><span class=n>v1</span><span class=o>|</span> <span class=k>where</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>|</span><span class=n>v1</span><span class=o>|</span> <span class=o>==</span> <span class=n>tmp</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>v1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>v1</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>      <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>return</span> <span class=n>v1</span>
</span></span></code></pre></div><p>The Whiley compiler will now verify this function is correct. The local variable <code>tmp</code> is acting as a ghost variable here.  This is because it was introduced just to ensure the function passes verification. The variable <code>tmp</code> simply saves the original length of <code>v1</code> and this allows us to state in the loop invariant that the size of <code>v1</code> is unchanged by the loop.</p><p>In the above example, the variable <code>tmp</code> is just an ordinary local variable. This is because Whiley has no explicit syntax for ghost variables. One simple idea is to introduce the <code>ghost</code> modifier to help signify a ghost variable. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl>   <span class=p>...</span>
</span></span><span class=line><span class=cl>   <span class=n>ghost</span> <span class=kt>int</span> <span class=n>tmp</span> <span class=o>=</span> <span class=o>|</span><span class=n>v1</span><span class=o>|</span> <span class=c1>// ghost variable
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=p>...</span>
</span></span></code></pre></div><p>This modifier would help clarity and would also signal to the compiler that this variable can be ignore in the generated executable file.</p><h2 id=conclusion>Conclusion</h2><p>Ghost variables are often used to help verify that a function meets its specification. Although Whiley has no explicit syntax for ghost variables, a similar can be achieved through the use of local variables.</p><hr></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-5582165-7","auto"),ga("send","pageview"))</script></body></html>