<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MRLB1FVZX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MRLB1FVZX",{anonymize_ip:!1})}</script><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Modular Purity Analysis for Java"><meta name=twitter:title content="Modular Purity Analysis for Java"><meta property="og:url" content="https://whileydave.com/2010/12/14/modular-purity-analysis-for-java/"><title>David J. Pearce
(Modular Purity Analysis for Java)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css><link rel=stylesheet href=https://whileydave.com/css/syntax.css></head><body><script>"use strict";function clearMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display="none",t.style.filter="")}function toggleMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display==="block"?(e.style.display="none",t.style.filter=""):(e.style.display="block",t.style.filter="brightness(0.8)"))}function toggleList(e){e.style.display="none";for(var t,o=e.parentNode,s=o.childNodes,n=0;n<s.length;++n)t=s[n],t.classList&&t.classList.contains("hidden")&&(t.style.display==="block"?t.style.display="none":t.style.display="block")}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a>
<a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a>
<a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a>
<a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Modular Purity Analysis for Java</h1><div class=post-date>Tuesday, December
14th,
2010</div><hr><p>Well, after an agonizing wait I finally heard the news that my paper on purity analysis was accepted to the <a href=http://www.complang.tuwien.ac.at/cc2011/>Conference on Compiler Construction, 2011</a>.  Obviously, I&rsquo;m stoked!  The paper is:</p><ul><li><strong>JPure: a Modular Purity System for Java</strong>. David J. Pearce. In <em>Proceedings of the Conference on Compiler Construction</em>, 2011. [<a href=http://homepages.ecs.vuw.ac.nz/%7Edjp/files/CC11a.pdf>PDF</a>]</li></ul><p>A <a href=http://wikipedia.org/wiki/Pure_function>pure function</a> is one which has no observable <a href=http://wikipedia.org/wiki/Side_effect_(computer_science)>side-effects</a>.  For example, it cannot modify any state that existed prior to the function being called.  Similarly, it may not read or write from I/O.  There are lots of advantages from knowing which functions are pure.  For example, it allows the compiler (or bytecode optimiser) to perform certain optimisations that would otherwise be considered unsafe (see e.g. <a href="http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=85DD615CAB9598700B76D69696BF4FCB?doi=10.1.1.24.1447&rep=rep1&type=pdf">this</a>, <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.90.2478&rep=rep1&type=pdf">this</a> and <a href=ftp://130.88.199.10/pub/apt/papers/ZhaoRogersKirkhamWatson_ICOOOLPS2008_purity.pdf>this</a>).  Purity information can also help with <em>automatic parallelisation</em> (e.g. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.96.6514&rep=rep1&type=pdf">this</a> and <a href="http://portal.acm.org/citation.cfm?id=1806596.1806638">this</a>), and <em>software verification</em> (e.g. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.4.9622&rep=rep1&type=pdf">this</a> and <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.61.1997&rep=rep1&type=pdf">this</a>).</p><p>Right, so pure functions are useful &mldr; but, how do they work?  A simple way of including purity in a language like Java is through annotations.  Here, we annotate methods with <code>@Pure</code> to signal they are pure functions.  Then, we want a type checker for the annotations, to ensure we use them correctly.  Typically this would operate by examining the body of every method marked <code>@Pure</code>, and checking:</p><ul><li><p>For every invocation, the static type of the method being invoked is marked <code>@Pure</code>.</p></li><li><p>The method makes no field assignments.</p></li><li><p>If the method overrides a method annotated <code>@Pure</code>, then it is also annotated <code>@Pure</code>.</p></li></ul><p>These rules ensure that the method has no side-effects, provided the <code>@Pure</code> annotations on other methods are themselves correct.  However, these rules are extremely restrictive.  Consider a very simple Java method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Example</span> <span class=o>{</span>
</span></span><span class=line><span class=cl> <span class=kd>private</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>items</span> <span class=o>=</span> <span class=o>...;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=kt>boolean</span> <span class=nf>contains</span><span class=o>(</span><span class=n>String</span> <span class=n>item</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span> <span class=o>:</span> <span class=n>items</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>       <span class=k>if</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>item</span><span class=o>))</span> <span class=o>{</span> <span class=k>return</span> <span class=kc>true</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}}</span>
</span></span></code></pre></div><p>This method cannot be annotated <code>@Pure</code>, even though it clearly is a pure function.  Why?  Well, because it uses an <code>Iterator</code> object to traverse <code>items</code>, and <code>Iterator.next()</code> cannot be annotated <code>@Pure</code> (since implementations of <code>Iterator</code> must be able update their internal state here).</p><p>However, whilst the <code>contains()</code> method above is not considered pure under rules (1-3), it does not break our original requirements for purity (given at the top of this article).  That&rsquo;s because <code>contains()</code> doesn&rsquo;t modify any state that existed before the method was called &mdash; only state <em>created</em> during its execution.  All we need to do is extend our rules for checking purity to allow for this &mldr;</p><p>&mldr; which is exactly what my paper is all about.  But, I won&rsquo;t spoil it for you here &mldr; it&rsquo;s all in <a href=/publications/pea11_cc/>the paper</a>!!</p><hr></div></div></body></html>