<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Thinking about Pre- and Post-Conditions in Whiley"><meta name=twitter:title content="Thinking about Pre- and Post-Conditions in Whiley"><meta property="og:url" content="https://whileydave.com/2010/07/23/thinking-about-pre-and-post-conditions-in-whiley/"><title>David J. Pearce
(Thinking about Pre- and Post-Conditions in Whiley)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css><link rel=stylesheet href=https://whileydave.com/css/syntax.css></head><body><script>"use strict";function clearMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display="none",t.style.filter="")}function toggleMenu(){var e,t,n=window.matchMedia("(max-width: 992px)");n.matches&&(e=document.getElementById("menu-content"),t=document.getElementById("menu"),e.style.display==="block"?(e.style.display="none",t.style.filter=""):(e.style.display="block",t.style.filter="brightness(0.8)"))}function toggleList(e){e.style.display="none";for(var t,o=e.parentNode,s=o.childNodes,n=0;n<s.length;++n)t=s[n],t.classList&&t.classList.contains("hidden")&&(t.style.display==="block"?t.style.display="none":t.style.display="block")}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a>
<a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a>
<a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a>
<a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Thinking about Pre- and Post-Conditions in Whiley</h1><div class=post-date>Friday, July
23rd,
2010</div><hr><p>The notion of <a href=http://wikipedia.org/wiki/precondition>pre-</a> and <a href=http://wikipedia.org/wiki/postcondition>post-conditions</a> is well understood in the context of software verification.  However, Whiley deviates from the norm by combining them into a single condition.  The following illustrates a simple Whiley function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=k>where</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=err>$</span> <span class=o>&amp;&amp;</span> <span class=err>$</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>x</span><span class=o>-</span><span class=mi>1</span>
</span></span></code></pre></div><p>Here, <code>$</code> represents the return value.  Whilst this deviation from normal pre- and post-conditions may seem a little unnecessary, there are good reasons for it.  In particular, I want to allow first-class functions (similar to <a href=http://wikipedia.org/wiki/function_pointer>function pointers</a> in C).  We might define the type of a function as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=n>define</span> <span class=n>func</span> <span class=n>as</span> <span class=kt>int</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=k>where</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=err>$</span> <span class=o>&amp;&amp;</span> <span class=err>$</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span></code></pre></div><p>At this point, we can write functions that accept <code>func</code> variables like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kt>int</span> <span class=n>g</span><span class=p>(</span><span class=n>func</span> <span class=n>f</span><span class=p>,</span> <span class=kt>int</span> <span class=n>x</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span></code></pre></div><p>This is an important feature for enabling various kinds of <a href=http://wikipedia.org/wiki/polymorphism_in_object-oriented_programming>polymorphism</a> within Whiley.  Using <code>where</code> for functions helps keep the <code>define</code> statement consistent across both normal data types and function types.</p><p><em>So, why does this cause some interesting problems?</em> Well, the problem is that we need to extract the pre- and post-conditions from this, in order to perform the necessary compile-time or run-time checks.  Looking at the first example above, we can draw the following conclusions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PRECONDITION: x &gt; 1
</span></span></span><span class=line><span class=cl><span class=c1>// POSTCONDITION: x &gt; $ &amp;&amp; $ &gt; 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=k>where</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=err>$</span> <span class=o>&amp;&amp;</span> <span class=err>$</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>x</span><span class=o>-</span><span class=mi>1</span>
</span></span></code></pre></div><p>Extracting the post-condition is, in fact, relatively easy &mdash; we can just identify the (maximum) <a href=http://wikipedia.org/wiki/connected_component_(graph_theory)>connected component</a> containing <code>$</code>.  However, extracting the pre-condition seems harder, since it requires non-trivial reasoning about the condition.  In this case, it&rsquo;s fairly straightforward to apply <a href=http://wikipedia.org/wiki/fourier-motzkin_elimination>Fourier-Motzkin Elimination</a> on <code>$</code> to obtain the desired result.</p><p>Other examples seem more tricky, and I&rsquo;m unsure about them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=k>where</span> <span class=n>g</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>==</span> <span class=err>$</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>g</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span></code></pre></div><p>Here, the question is whether or not <code>g(x) == $</code> imposes any constraint upon <code>x</code> before the function call (i.e whether it is a pre-condition of some sort). Suppose we had this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-whiley data-lang=whiley><span class=line><span class=cl><span class=kt>int</span> <span class=n>g</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=k>where</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=err>$</span> <span class=o>&gt;</span> <span class=n>x</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=o>+</span><span class=mi>1</span>
</span></span></code></pre></div><p>This would appear to impose some constraints upon <code>x</code>.</p><p>Anyway, that&rsquo;s about as far as I&rsquo;ve got in my thinking around this problem.  I guess an obvious solution is simply to mandate that any part of the condition which involves <code>$</code> is strictly the post-condition, and cannot be considered part of the pre-condition. Whilst this would resolve the issue, it has slightly non-intuitive semantics in some cases (such as the first example). Certainly, one can always rewrite the conditions to make everything explicit as would be required, but that seems less than ideal.</p><hr></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-5582165-7","auto"),ga("send","pageview"))</script></body></html>