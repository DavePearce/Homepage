<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Encoding C Strings in Whiley"><meta name=twitter:title content="Encoding C Strings in Whiley"><meta property="og:url" content="https://whileydave.com/2015/11/12/encoding-c-strings-in-whiley/"><title>David J. Pearce
(Encoding C Strings in Whiley)</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://whileydave.com/css/page.css><link rel=stylesheet href=https://whileydave.com/css/menu.css><link rel=stylesheet href=https://whileydave.com/css/style.css></head><body><script>"use strict";function clearMenu(){var q=window.matchMedia("(max-width: 992px)");if(q.matches){var c=document.getElementById("menu-content");var m=document.getElementById("menu");c.style.display='none';m.style.filter='';}}
function toggleMenu(){var q=window.matchMedia("(max-width: 992px)");if(q.matches){var c=document.getElementById("menu-content");var m=document.getElementById("menu");if(c.style.display==='block'){c.style.display='none';m.style.filter='';}else{c.style.display='block';m.style.filter="brightness(0.8)";}}}
function toggleList(element){element.style.display="none";var parent=element.parentNode;var items=parent.childNodes;for(var i=0;i<items.length;++i){var item=items[i];if(item.classList&&item.classList.contains("hidden")){if(item.style.display==='block'){item.style.display="none";}else{item.style.display="block";}}}}</script><header class=topbar><div class=topbar-header onclick=clearMenu()><div class=topbar-title>Dr. David J. Pearce</div><div class=topbar-subtitle></div></div><div class=topbar-social onclick=clearMenu()><a href=https://github.com/DavePearce><i class="fa fa-github" aria-hidden=true></i></a><a href=https://twitter.com/WhileyDave><i class="fa fa-twitter" aria-hidden=true></i></a><a href=https://www.youtube.com/user/redjamjar/><i class="fa fa-youtube-play" aria-hidden=true></i></a><a href=https://www.linkedin.com/in/david-pearce-8592647/><i class="fa fa-linkedin-square" aria-hidden=true></i></a></div><div class=topbar-menu><div id=menu onclick=toggleMenu()><div id=menu-icon><img src=https://whileydave.com/images/menu.png alt=Menu></div><div id=menu-content><a href=https://whileydave.com/blog/>Blog</a>
<a href=https://whileydave.com/projects/>Projects</a>
<a href=https://whileydave.com/publications/>Publications</a>
<a href=https://whileydave.com/talks/>Talks</a>
<a href=https://whileydave.com/>Home</a></div></div></div></header><div class=container onclick=clearMenu()><div class=content><h1 class=post-title>Encoding C Strings in Whiley</h1><div class=post-date>Thursday, November
12th,
2015</div><hr><p>In this post, we&rsquo;re going to consider representing the classic <a href=http://en.wikipedia.org/wiki/C_string_handling>C string</a> in Whiley. This turns out to be useful as we can then try to verify properties about functions which operate on C strings (e.g. <code>strlen()</code>, <code>strcpy()</code>, etc). If you&rsquo;re not familiar with C strings, then the main points are:</p><ul><li><p>Roughly speaking, C Strings are arrays of 8bit <a href=http://en.wikipedia.org/wiki/ASCII>ASCII</a> characters.</p></li><li><p>C Strings are terminated by the special character <code>'\0'</code> (also called <a href=http://en.wikipedia.org/wiki/Null-terminated_string>null terminated strings</a>).</p></li><li><p>C Strings do not carry any other length information (e.g. for the size of the containing memory chunk).</p></li></ul><p>The interesting thing about Whiley is that we can encode these constraints within the language itself using only the built-in list and integer types. Specifically, we&rsquo;re going to encode a C string as a constrained list of constrained integers. The list will be constrained to ensure it is <code>null</code> terminated, whilst the contained integers will be constrained to ensure they are between <code>0</code> and <code>255</code>.</p><p>Before giving our definition of a C string in Whiley, we need to first define the notion of an 8bit ASCII character. This is done as follows:</p><pre><code class=language-whiley data-lang=whiley>// Define the ASCII 8bit character
type ASCII_char is (int n) where 0 &lt;= n &amp;&amp; n &lt;= 255
</code></pre><p>Here, we have defined an 8bit ASCII character to be an integer which is constrained between <code>0</code> and <code>255</code> (i.e. to ensure it fits in 8 bits). Using this, we can now define our notion of a <code>C</code> string as follows.</p><pre><code class=language-whiley data-lang=whiley>// Define the null terminator
constant NULL is 0

type C_string is (ASCII_char[] str)
// Must have at least one character (i.e. null terminator)
where |str| &gt; 0 &amp;&amp; some { i in 0 .. |str| | str[i] == NULL }
</code></pre><p>Here, we have then defined a <code>C_String</code> to be a list of integers which is constrained to ensure it is always null terminated. That is, there is always at least one NULL terminator somewhere in the array (though there may be several).</p><p>As an example to illustrate the use of our <code>C_string</code>, we provide an implementation of the well-known <code>strlen()</code> function below:</p><pre><code class=language-whiley data-lang=whiley>// Determine the length of a C string.
function strlen(C_string str) -&gt; (int r)
ensures str[r] == NULL
ensures all { k in 0 .. r | str[k] != NULL }:
  //
  int i = 0
  //
  while str[i] != NULL
  where i &gt;= 0 &amp;&amp; i &lt; |str|
  where all { k in 0 .. i | str[k] != NULL}:
    i = i + 1
  //
  return i
</code></pre><p>The Whiley compiler statically verifies this function does not overrun the string bounds. The loop invariant given by the <code>where</code> clause is needed as a hint to the verifier, but does not affect the function&rsquo;s execution in any way.</p><hr></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-5582165-7','auto');ga('send','pageview');}</script></body></html>